<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥ä½œæ¥­å“¡å·¥æ™‚æ˜ç´°è¡¨ç”¢ç”Ÿå™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            line-height: 1.4;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-size: 2.2em;
            line-height: 1.3;
        }
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 10px;
            padding: 32px;
            text-align: center;
            margin-bottom: 25px;
            background: #f8f9fa;
            transition: all 0.3s ease;
            line-height: 1.4;
        }
        .upload-area:hover {
            background: #e9ecef;
            border-color: #2980b9;
        }
        .upload-area.dragover {
            background: #d4edda;
            border-color: #28a745;
        }
        input[type="file"] {
            display: none;
        }
        .upload-btn, .process-btn, .download-btn {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
        }
        .upload-btn:hover, .process-btn:hover, .download-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        .process-btn {
            background: #27ae60;
            width: 100%;
            font-size: 18px;
            font-weight: bold;
            padding: 12px 25px;
            margin: 16px 0;
        }
        .process-btn:hover {
            background: #229954;
        }
        .process-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        .download-btn {
            background: #e74c3c;
        }
        .download-btn:hover {
            background: #c0392b;
        }
        .results {
            margin-top: 25px;
            padding: 18px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #3498db;
            line-height: 1.4;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 16px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            line-height: 1.2;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }
        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }
        .sample-data {
            background: white;
            border-radius: 10px;
            padding: 16px;
            margin-top: 16px;
            overflow-x: auto;
            line-height: 1.3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            line-height: 1.3;
        }
        th {
            background: #f1f2f6;
            font-weight: bold;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .warning-icon {
            color: #e74c3c;
            font-weight: bold;
            margin-right: 5px;
            font-size: 1.2em;
        }
        .abnormal-row {
            background-color: #fff5f5;
        }
        .hours-cell {
            font-weight: bold;
        }
        .abnormal-hours {
            color: #e74c3c;
        }
        .normal-hours {
            color: #27ae60;
        }
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background: white;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        .csv-output {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 16px;
            color: #7f8c8d;
            font-size: 14px;
            border-top: 1px solid #ecf0f1;
        }
        .footer .sparkle {
            color: #f39c12;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š æ¯æ—¥ä½œæ¥­å“¡å·¥æ™‚æ˜ç´°è¡¨ç”¢ç”Ÿå™¨</h1>
        
        <div class="upload-area" id="uploadArea">
            <h3>ğŸ“ è«‹é¸æ“‡æˆ–æ‹–æ‹½ MES å·¥å–®äººå“¡è¨˜éŒ„è¡¨æª”æ¡ˆ</h3>
            <p>æ”¯æ´æ ¼å¼: Excel (.xlsx, .xls)</p>
            <input type="file" id="fileInput" accept=".xlsx,.xls">
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                é¸æ“‡æª”æ¡ˆ
            </button>
            <div id="fileName" style="margin-top: 15px; font-weight: bold; color: #2c3e50;"></div>
        </div>

        <button class="process-btn" id="processBtn" onclick="processFile()" disabled>
            ğŸ”„ é–‹å§‹è™•ç†ä¸¦ç”¢ç”Ÿå ±è¡¨
        </button>

        <div id="filterArea" class="results" style="display: none;">
            <h3>ğŸ” ç¯©é¸æ¢ä»¶</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label for="dateSelect">é¸æ“‡æ—¥æœŸï¼š</label>
                    <select id="dateSelect">
                        <option value="">å…¨éƒ¨æ—¥æœŸ</option>
                    </select>
                </div>
                <div>
                    <label for="factorySelect">é¸æ“‡å» åˆ¥ï¼š</label>
                    <select id="factorySelect">
                        <option value="">å…¨éƒ¨å» åˆ¥</option>
                    </select>
                </div>
            </div>
            <button class="process-btn" onclick="applyFilters()" style="background: #f39c12;">
                ğŸ“‹ å¥—ç”¨ç¯©é¸ä¸¦é¡¯ç¤ºçµæœ
            </button>
        </div>

        <div id="results" class="results" style="display: none;">
            <h3>ğŸ“ˆ ç¯©é¸çµæœ</h3>
            <div id="resultsContent"></div>
        </div>
        
        <div class="results" style="margin-top: 20px;">
            <h3>ğŸ“‹ è³‡æ–™è™•ç†æ’é™¤è¦å‰‡èªªæ˜</h3>
            <div style="background: white; border-radius: 10px; padding: 16px; line-height: 1.5;">
                <p><strong>ç³»çµ±æœƒè‡ªå‹•æ’é™¤ä»¥ä¸‹é¡å‹çš„è¨˜éŒ„ï¼š</strong></p>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li><strong>ç¼ºå°‘å¿…è¦è³‡æ–™ï¼š</strong>å“¡å·¥å§“åã€é–‹å§‹ç”Ÿç”¢æ™‚é–“ã€çµæŸç”Ÿç”¢æ™‚é–“ä»»ä¸€æ¬„ä½ç‚ºç©ºç™½çš„è¨˜éŒ„</li>
                    <li><strong>æ™‚é–“å·®éçŸ­ï¼š</strong>ã€ŒçµæŸæ™‚é–“ã€æ¸›å»ã€Œé–‹å§‹æ™‚é–“ã€åœ¨10ç§’å…§çš„è¨˜éŒ„ï¼ˆä¾‹å¦‚ï¼šæ™‚é–“å·®ç‚º5ç§’çš„è¨˜éŒ„å°‡è¢«å®Œå…¨å¿½ç•¥ï¼Œä¸æœƒå‡ºç¾åœ¨ä»»ä½•çµ±è¨ˆä¸­ï¼‰</li>
                </ul>
                <p><strong>è³‡æ–™åˆä½µè¦å‰‡ï¼š</strong></p>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>åŒä¸€å“¡å·¥åœ¨åŒä¸€å¤©åŒä¸€å» åˆ¥çš„å¤šç­†è¨˜éŒ„æœƒåˆä½µç‚ºä¸€ç­†</li>
                    <li>é–‹å§‹æ™‚é–“å–æœ€æ—©æ™‚é–“ï¼ŒçµæŸæ™‚é–“å–æœ€æ™šæ™‚é–“</li>
                    <li>è¨­å‚™æ¬„ä½æœƒæ”¶é›†æ‰€æœ‰ä½¿ç”¨çš„è¨­å‚™ä»£ç¢¼ï¼Œç”¨åˆ†è™Ÿ(;)åˆ†éš”</li>
                </ul>
                <p><strong>ç•°å¸¸å·¥æ™‚åˆ¤å®šï¼š</strong></p>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>å·¥ä½œæ™‚é–“å°‘æ–¼8å°æ™‚æˆ–è¶…é13å°æ™‚è¦–ç‚ºç•°å¸¸</li>
                </ul>
            </div>
        </div>
        
        <div class="footer">
            <span class="sparkle">âœ¨</span>Learn with Tarshar â€” 2025
        </div>
    </div>

    <script>
// ========= 1ï¸âƒ£ åœ¨ä¸»ç¨‹å¼æœ€å‰é¢ï¼ŒExcel è®€å–ä¹‹å‰ =========
// æ‰€æœ‰å“¡å·¥è³‡æ–™å¯«åœ¨ç¨‹å¼è£¡
const employees =[
        { name: "è‡ªå‹•æ©Ÿå°_åšå£«01", dept: "åšå£«å» _æˆå‹" },
      { name: "è‡ªå‹•æ©Ÿå°_åšå£«02", dept: "åšå£«å» _æˆå‹" },
      { name: "è‡ªå‹•æ©Ÿå°_åšå£«03", dept: "åšå£«å» _æˆå‹" },
      { name: "æ—ç§€å¯ŒP021", dept: "åšå£«å» (æŠ€è¡“å“¡)" },
      { name: "è—å£«æ·»P018", dept: "åšå£«å» (æŠ€è¡“å“¡)" },
      { name: "é™³ä¿Šç¿°P030", dept: "åšå£«å» (æŠ€è¡“å“¡)" },
      { name: "åŠ‰é€²é¾P004", dept: "åšå£«å» (æŠ€è¡“å“¡)" },
      { name: "æ—æœˆç¾P011", dept: "åšå£«å» _æˆå‹" },
      { name: "éƒ­æ°ç„P019", dept: "åšå£«å» _æˆå‹" },
      { name: "é»ƒæ°ç‰P069", dept: "åšå£«å» _æˆå‹" },
      { name: "èŒƒé‡‘ç·šP016", dept: "åšå£«å» _æˆå‹" },
      { name: "é˜®ç‰è¶ŠP029", dept: "åšå£«å» _æˆå‹" },
      { name: "æ—æºå¯ŒP009", dept: "åšå£«å» (æŠ€è¡“å“¡)" },
      { name: "è”¡éˆºä¼¶P075", dept: "åšå£«å» _æˆå‹" },
      { name: "è˜‡è¾›å’ŒP066", dept: "åšå£«å» (æŠ€è¡“å“¡)" },
      { name: "ç¾…çå¨œP077", dept: "åšå£«å» _æˆå‹" },
      { name: "å¼µæ™¯é´»P032", dept: "åšå£«å» (æŠ€è¡“å“¡)" },
      { name: "é»ƒé³´è©©P071", dept: "åšå£«å» _æˆå‹" },
      { name: "é˜®èŠ³ç¿ P106", dept: "åšå£«å» _æˆå‹" },
      { name: "æ—é›…é›¯P020", dept: "åšå£«å» _æˆå‹" },
      { name: "å¡”ç“¦P081", dept: "åšå£«å» _æˆå‹" },
      { name: "é˜¿å¡ç›§P095", dept: "åšå£«å» _æˆå‹" },
      { name: "æå½­P093", dept: "åšå£«å» _æˆå‹" },
      { name: "ç¾…åŒP064", dept: "åšå£«å» _æˆå‹" },
      { name: "å¡”æ¾P049", dept: "åšå£«å» _æˆå‹" },
      { name: "æ°å°¼P096", dept: "åšå£«å» _æˆå‹" },
      { name: "å½­ç­è¿ªP065", dept: "åšå£«å» _æˆå‹" },
      { name: "æŸ¯çŒœP084", dept: "åšå£«å» _æˆå‹" },
      { name: "é‚£é”æœ‹", dept: "åšå£«å» _æˆå‹" },
      { name: "æ¡‘å¼ŸP045", dept: "åšå£«å» _æˆå‹" },
      { name: "ç“¦å ¤è‚¯P104", dept: "åšå£«å» _æˆå‹" },
      { name: "ç¿’ç«‹P043", dept: "åšå£«å» _æˆå‹" },
      { name: "æ‹‰ä»–æœ‹P044", dept: "åšå£«å» _æˆå‹" },
      { name: "æ¥šæ²™å…‹P103", dept: "åšå£«å» _æˆå‹" },
      { name: "å°¤ä»–é‚£P055", dept: "åšå£«å» _æˆå‹" },
      { name: "é¦¬å—P092", dept: "åšå£«å» _æˆå‹" },
      { name: "å¸ƒå¯‡P083", dept: "åšå£«å» _æˆå‹" },
      { name: "å­Ÿæ˜†P054", dept: "åšå£«å» _æˆå‹" },
      { name: "å¡”ç´ç“¦P082", dept: "åšå£«å» _æˆå‹" },
      { name: "çš®å¡”äºP038", dept: "åšå£«å» _æˆå‹" },
      { name: "çš®æ²™åŠªP061", dept: "åšå£«å» _æˆå‹" },
      { name: "å­”æ©P063", dept: "åšå£«å» _æˆå‹" },
      { name: "æŸ¥å¸•è¿ªP105", dept: "åšå£«å» _æˆå‹" },
      { name: "è˜‡å¸•ç©ºP109", dept: "åšå£«å» _æˆå‹" },
      { name: "å¤æ¯”å¡”P085", dept: "åšå£«å» _æˆå‹" },
      { name: "å¾·æŸ¥P086", dept: "åšå£«å» _æˆå‹" },
      { name: "æ™®å¡”å¥ˆP087", dept: "åšå£«å» _æˆå‹" },
      { name: "é˜¿å¡å¸•P090", dept: "åšå£«å» _æˆå‹" },
      { name: "è’™ç©ºP091", dept: "åšå£«å» _æˆå‹" },
      { name: "é™³ç§€è¯A062", dept: "åšå£«å» _çµ„è£" },
      { name: "æ´ªéº—é›ªA063", dept: "åšå£«å» _çµ„è£" },
      { name: "æ¥Šç¾æ·‘A065", dept: "åšå£«å» _çµ„è£" },
      { name: "å¼µè‚²ç¦A068", dept: "åšå£«å» _çµ„è£" },
      { name: "æ®µç´ ç‰A099", dept: "åšå£«å» _çµ„è£" },
      { name: "é‡‘ç‰å¤A096", dept: "åšå£«å» _çµ„è£" },
      { name: "æ¥Šé›…é›²A085", dept: "åšå£«å» _çµ„è£" },
      { name: "æœä½©å„€A083", dept: "åšå£«å» _çµ„è£" },
      { name: "é‡‘ç‰é›²A066", dept: "åšå£«å» _çµ„è£" },
      { name: "æ­¦ç¬è“A090", dept: "åšå£«å» _çµ„è£" },
      { name: "é˜®é‡‘é³³A098", dept: "åšå£«å» _çµ„è£" },
      { name: "èƒ¡ç‰ç¾A080", dept: "åšå£«å» _çµ„è£" },
      { name: "æ—å£½ç A058", dept: "åšå£«å» _çµ„è£" },
      { name: "é™³ç¾ç‰A076", dept: "åšå£«å» _çµ„è£" },
      { name: "æ¥Šç¾ç²A056", dept: "åšå£«å» _çµ„è£" },
      { name: "ä»»æ±Ÿæ…§A057", dept: "åšå£«å» _çµ„è£" },
      { name: "å³éº—èA075", dept: "åšå£«å» _çµ„è£" },
      { name: "éƒ­ç²å›A061", dept: "åšå£«å» _çµ„è£" },
      { name: "è˜‡æ˜æ…¶", dept: "å®—ç‘‹å» (æŠ€è¡“å“¡)" },
      { name: "å¼µæ…¶åŸP002", dept: "å®—ç‘‹å» (æŠ€è¡“å“¡)" },
      { name: "ä¼å¼˜å®‡P005", dept: "å®—ç‘‹å» (æŠ€è¡“å“¡)" },
      { name: "é»ƒå­èŠ¸P006", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "æ—ä½³è“‰P007", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "å»–ä¿¡é–”P027", dept: "å®—ç‘‹å» (æŠ€è¡“å“¡)" },
      { name: "é™³ç¾æƒ P028", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é˜®æ°å®¹P026", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "ç¾…å®Œé‡‘P023", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é˜®é‡‘è‹±P022", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "èƒ¡è¬ç¦P010", dept: "å®—ç‘‹å» (æŠ€è¡“å“¡)" },
      { name: "æé˜®ç©—çœŸP073", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "è£´ç‰èP034", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é˜®æ¸…ç¿ P072", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é™³é”å’ŒP003", dept: "å®—ç‘‹å» (æŠ€è¡“å“¡)" },
      { name: "è£´æ°å‚èŠP035", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "éŸ‹å§¿ä¼¶P014", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é˜®æ˜¥è˜­P017", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é™³æ°é‡‘èŠP070", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é™³å¿ å‹‡P031", dept: "å®—ç‘‹å» (æŠ€è¡“å“¡)" },
      { name: "é¦®è–å´´P015", dept: "å®—ç‘‹å» (æŠ€è¡“å“¡)" },
      { name: "é™³æ°æ¢…P025", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é˜®é‡‘å¿ƒP024", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "ä¸æ°é‚ŠP074", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "è¢æ®é–P080", dept: "å®—ç‘‹å» (æŠ€è¡“å“¡)" },
      { name: "æ½˜è‰æ¬£P108", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é«˜æ°éŠ€P079", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é˜®æ°ç¿ å§®P033", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "è”¡ç§€æ…§", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "æ­¦æ˜¥ç™¾P040", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é™³é’é¢¨P088", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "æ­¦ç¶­æµ·P057", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é™³æ–‡å‹»P041", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "æœæ˜¥èˆˆP050", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é˜®æ¸…è±P052", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "ç«¥å‰å…¨P058", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "è£´ç¶­æ…¶P060", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é˜®æ–‡æ­£P046", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "è¶™æ¸…é¸P094", dept: "å®—ç‘‹å» (æŠ€è¡“å“¡)" },
      { name: "æ¥Šæ˜å…¨P053", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é˜®é»ƒè‹±P099", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é„­ç‰è‹±P062", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é˜®ä¿Šè‹±P039", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "æ¥Šæ˜æ–°P048", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "ä¸å…‰é«˜P047", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é™³å®¶åº·P059", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "è•ƒåº­å…ƒP098", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é˜®æ˜å›P097", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é»ƒé«˜å¼·P100", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "æ½˜è¶Šè‹±P051", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é»é•·è©©P042", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "è£´å…‰ä¿¡", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "è¶™é€²æ°´P056", dept: "å®—ç‘‹å» _æˆå‹" },
      { name: "é„­æ˜å§A054", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "é™³ç§€å¨ŸA059", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "é¾ç‰ç´A070", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "ææ˜Œè˜­A073", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "ç›§ç§€è²A087", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "ææ›‰æ—­A074", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "é»ƒéŸ‹ä½©å¨ŸA092", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "æº«æ¬£æ€¡A097", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "è‘‰æƒ å¨ŸA064", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "å‘¨è˜­èŠ³A082", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "èŒƒä»¥æ™´A081", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "é»ƒæ°ç¿ ç‘©A100", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "è¨±æƒ æ•A094", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "æç²æ—‹A069", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "åŠ‰éº—èŠ³A093", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "é™³ç¢§A088", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "è”¡ç¾ç¥ºA078", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "ç‹æ˜±é›¯A091", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "é‚±é›…ç²A079", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "å³ç´ç´A104", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "ç°¡æ˜ç« A095", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "æé›ªå›A060", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "èŒƒé‡‘ç‰A071", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "ä½•å®¶ç‘œA052", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "éŒ¢å·§èA086", dept: "å®—ç‘‹å» _çµ„è£" },
      { name: "é˜®æ°èŠ³é¶¯A055", dept: "å®—ç‘‹å» _çµ„è£" }
];
// ç¯©é¸å‡½å¼ï¼ŒåŠ åœ¨åŸæœ¬é¡¯ç¤ºå‰
function filterByEmployeeAndFactory(attendanceList, selectedFactory) {
    return attendanceList.filter(att => 
        att.factory === selectedFactory && 
        employeeList.some(emp => emp.name === att.name && emp.factory === att.factory)
    );
}

// åŸæœ¬é¡¯ç¤ºä¸Šå·¥çš„ç¨‹å¼ï¼ˆå‡è¨­æ˜¯é€™æ¨£ï¼‰
function displayAttendance(attendanceList, selectedFactory) {
    // åŠ ä¸Šç¯©é¸
    const filteredList = filterByEmployeeAndFactory(attendanceList, selectedFactory);

    // ä»¥ä¸‹ä¿æŒåŸæœ¬é¡¯ç¤ºé‚è¼¯
    filteredList.forEach(att => {
        // åŸæœ¬çš„ DOM é¡¯ç¤ºç¨‹å¼
        console.log(att.name); // æˆ–è€…ä½ çš„è¡¨æ ¼å¡«å……ç¨‹å¼
    });
}
// ========= 2ï¸âƒ£ ä½ åŸæœ¬çš„ç¨‹å¼è®€ Excel ä¸Šä¸‹å·¥ç´€éŒ„ =========
// records = ... é€™è£¡è®€ Excel
        
        let allProcessedData = null;
        let processedData = null;

        // æ—¥æœŸæ ¼å¼åŒ–å‡½æ•¸ - ä¿®æ­£ç‚º YYYY/MM/DD æ ¼å¼
        function formatDate(dateStr) {
            if (!dateStr) return '';
            
            // å¦‚æœå·²ç¶“æ˜¯ YYYY/MM/DD æ ¼å¼ï¼Œç›´æ¥è¿”å›
            if (typeof dateStr === 'string' && dateStr.match(/^\d{4}\/\d{2}\/\d{2}$/)) {
                return dateStr;
            }
            
            // å¦‚æœæ˜¯ YYYY/M/D æ ¼å¼ï¼Œè£œé›¶
            if (typeof dateStr === 'string' && dateStr.match(/^\d{4}\/\d{1,2}\/\d{1,2}$/)) {
                const parts = dateStr.split('/');
                const year = parts[0];
                const month = parts[1].padStart(2, '0');
                const day = parts[2].padStart(2, '0');
                return `${year}/${month}/${day}`;
            }
            
            // å˜—è©¦è§£æç‚ºæ—¥æœŸç‰©ä»¶
            try {
                const date = new Date(dateStr);
                if (!isNaN(date.getTime())) {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}/${month}/${day}`;
                }
            } catch (e) {
                console.warn('ç„¡æ³•è§£ææ—¥æœŸ:', dateStr);
            }
            
            return dateStr;
        }

        // è³‡æ–™æ’åºå‡½æ•¸ - å…ˆä¾ç•°å¸¸ç‹€æ³æ’åºï¼Œå†ä¾å·¥æ™‚æ•¸å€¼æ’åº
        function sortData(data) {
            return data.sort((a, b) => {
                // ç¬¬ä¸€å„ªå…ˆï¼šç•°å¸¸ç‹€æ³æ’åºï¼ˆç•°å¸¸åœ¨å‰ï¼‰
                if (a.ç•°å¸¸ç‹€æ³ !== b.ç•°å¸¸ç‹€æ³) {
                    return b.ç•°å¸¸ç‹€æ³ - a.ç•°å¸¸ç‹€æ³; // true(1) åœ¨å‰ï¼Œfalse(0) åœ¨å¾Œ
                }
                
                // ç¬¬äºŒå„ªå…ˆï¼šå·¥æ™‚æ•¸å€¼ç”±å°‘åˆ°å¤š
                return a.å·¥æ™‚æ•¸å€¼ - b.å·¥æ™‚æ•¸å€¼;
            });
        }

        // æª”æ¡ˆæ‹–æ‹½è™•ç†
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            uploadArea.classList.add('dragover');
        }

        function unhighlight(e) {
            uploadArea.classList.remove('dragover');
        }

        uploadArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        fileInput.addEventListener('change', function(e) {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            if (files.length > 0) {
                const file = files[0];
                document.getElementById('fileName').textContent = `å·²é¸æ“‡: ${file.name}`;
                document.getElementById('processBtn').disabled = false;
                window.selectedFile = file;
            }
        }

        async function processFile() {
            if (!window.selectedFile) {
                alert('è«‹å…ˆé¸æ“‡æª”æ¡ˆ');
                return;
            }

            const filterArea = document.getElementById('filterArea');
            filterArea.style.display = 'block';
            
            filterArea.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨è™•ç†è³‡æ–™ï¼Œè«‹ç¨å€™...</p>
                </div>
            `;

            try {
                const arrayBuffer = await window.selectedFile.arrayBuffer();
                const data = new Uint8Array(arrayBuffer);
                const originalWorkbook = XLSX.read(data, { type: 'array' });
                
                const firstSheetName = originalWorkbook.SheetNames[0];
                const worksheet = originalWorkbook.Sheets[firstSheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                
                const headers = jsonData[0];
                console.log('Excel æ¨™é¡Œè¡Œ:', headers);
                
                // æ ¹æ“šå¯¦éš›çš„Excelæª”æ¡ˆçµæ§‹èª¿æ•´æ¬„ä½ç´¢å¼•
                // å¾åˆ†æçµæœçœ‹ï¼Œæ¬„ä½é †åºæ˜¯ï¼šæ—¥æœŸ, å“¡å·¥ä»£è™Ÿ, å“¡å·¥å§“å, è£½ç¨‹, è¨­å‚™ä»£ç¢¼, è¨­å‚™åç¨±, å·¥å–®å–®è™Ÿ, ç”Ÿç”¢æ‰¹è™Ÿ, ç”¢å“ç·¨è™Ÿ, ç”¢å“åç¨±, é–‹å§‹ç”Ÿç”¢æ™‚é–“, çµæŸç”Ÿç”¢æ™‚é–“, å·¥æ™‚
                const records = jsonData.slice(1).filter(row => {
                    // åŸºæœ¬è³‡æ–™æª¢æŸ¥ï¼šå“¡å·¥å§“å, é–‹å§‹ç”Ÿç”¢æ™‚é–“, çµæŸç”Ÿç”¢æ™‚é–“
                    if (!row[2] || !row[10] || !row[11]) return false;
                    
                    // æ’é™¤æ¢ä»¶ï¼šå¿½ç•¥çµæŸæ™‚é–“èˆ‡é–‹å§‹æ™‚é–“å·®è·åœ¨10ç§’å…§çš„è¨˜éŒ„
                    const startTime = new Date(row[10]);
                    const endTime = new Date(row[11]);
                    const timeDiffSeconds = (endTime - startTime) / 1000;
                    
                    return timeDiffSeconds > 10; // åªä¿ç•™æ™‚é–“å·®å¤§æ–¼10ç§’çš„è¨˜éŒ„
                });
                
                const dailyStats = {};

                records.forEach(row => {
                    const dateValue = row[0]; // æ—¥æœŸæ¬„ä½
                    const employeeName = row[2]; // å“¡å·¥å§“å
                    const equipmentCode = row[4]; // è¨­å‚™ä»£ç¢¼
                    const equipmentName = row[5]; // è¨­å‚™åç¨±
                    const workOrderNo = row[6]; // å·¥å–®å–®è™Ÿ
                    const startTime = row[10]; // é–‹å§‹ç”Ÿç”¢æ™‚é–“
                    const endTime = row[11]; // çµæŸç”Ÿç”¢æ™‚é–“
                    
                    let factory = 'å…¶ä»–';
                    if (workOrderNo) {
                        const prefix = workOrderNo.toString().substring(0, 4);
                        switch(prefix) {
                            case 'GE11': factory = 'å®—ç‘‹å» _æˆå‹'; break;
                            case 'DE11': factory = 'åšå£«å» _æˆå‹'; break;
                            case 'GE31': factory = 'å®—ç‘‹å» _çµ„è£'; break;
                            case 'DE31': factory = 'åšå£«å» _çµ„è£'; break;
                        }
                    }
                    
                    // è™•ç†è¨­å‚™è³‡è¨Š - åªé¡¯ç¤ºè¨­å‚™ä»£ç¢¼
                    let equipment = '';
                    if (equipmentCode) {
                        equipment = equipmentCode;
                    }
                    
                    // ä½¿ç”¨æ—¥æœŸæ¬„ä½çš„å€¼ï¼Œå¦‚æœæ˜¯å­—ä¸²æ ¼å¼å‰‡ç›´æ¥ä½¿ç”¨ï¼Œå¦å‰‡å¾é–‹å§‹æ™‚é–“æå–æ—¥æœŸ
                    let workDate;
                    if (dateValue && typeof dateValue === 'string' && dateValue.includes('/')) {
                        workDate = formatDate(dateValue);
                    } else {
                        // å¾é–‹å§‹æ™‚é–“æå–æ—¥æœŸ
                        workDate = formatDate(new Date(startTime));
                    }
                    
                    const key = `${employeeName}_${workDate}_${factory}`;
                    
                    if (!dailyStats[key]) {
                        dailyStats[key] = {
                            å“¡å·¥å§“å: employeeName,
                            å» åˆ¥: factory,
                            å·¥ä½œæ—¥æœŸ: workDate,
                            é–‹å§‹æ™‚é–“: startTime,
                            çµæŸæ™‚é–“: endTime,
                            è¨­å‚™: equipment ? [equipment] : []
                        };
                    } else {
                        if (new Date(startTime) < new Date(dailyStats[key].é–‹å§‹æ™‚é–“)) {
                            dailyStats[key].é–‹å§‹æ™‚é–“ = startTime;
                        }
                        if (new Date(endTime) > new Date(dailyStats[key].çµæŸæ™‚é–“)) {
                            dailyStats[key].çµæŸæ™‚é–“ = endTime;
                        }
                        // æ”¶é›†è¨­å‚™è³‡è¨Šï¼Œé¿å…é‡è¤‡
                        if (equipment && !dailyStats[key].è¨­å‚™.includes(equipment)) {
                            dailyStats[key].è¨­å‚™.push(equipment);
                        }
                    }
                });
// ===== åœ¨é€™è£¡æ–°å¢ç„¡ä¸Šå·¥ç´€éŒ„ =====
Object.keys(employees).forEach(id => {
    // å‡è¨­ employees æ˜¯ä½ æ”¾åœ¨ç¨‹å¼è£¡çš„å“¡å·¥è³‡æ–™ç‰©ä»¶ï¼Œæ ¼å¼ï¼š{å·¥è™Ÿ: å§“å, ...}
    const name = employees[id];

    // æª¢æŸ¥ dailyStats æ˜¯å¦å·²æœ‰è©²å“¡å·¥è³‡æ–™
    const hasRecord = Object.values(dailyStats).some(stat => stat.å“¡å·¥å§“å === name);
    if (!hasRecord) {
        // éš¨ä¾¿çµ¦å€‹æ—¥æœŸï¼Œä¾‹å¦‚ä»Šå¤©ï¼Œæˆ–ä¿ç•™ç©ºå­—ä¸²
        const workDate = '';
        const factory = '';
        dailyStats[`${name}_${workDate}_${factory}`] = {
            å“¡å·¥å§“å: name,
            å» åˆ¥: factory,
            å·¥ä½œæ—¥æœŸ: workDate,
            é–‹å§‹æ™‚é–“: '',
            çµæŸæ™‚é–“: '',
            è¨­å‚™: []
        };
    }
});

                const results = [];
                Object.values(dailyStats).forEach(stat => {
                    const start = new Date(stat.é–‹å§‹æ™‚é–“);
                    const end = new Date(stat.çµæŸæ™‚é–“);
                    const hoursDiff = (end - start) / (1000 * 60 * 60);
                    
                    const startTimeStr = start.toLocaleTimeString('zh-TW', { 
                        hour: '2-digit', 
                        minute: '2-digit', 
                        hour12: false 
                    });
                    const endTimeStr = end.toLocaleTimeString('zh-TW', { 
                        hour: '2-digit', 
                        minute: '2-digit', 
                        hour12: false 
                    });
                    
                    const totalMinutes = Math.round(hoursDiff * 60);
                    const hours = Math.floor(totalMinutes / 60);
                    const minutes = totalMinutes % 60;
                    const durationStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                    
                    const isAbnormal = hoursDiff < 8 || hoursDiff > 13;
                    
                    // å°‡è¨­å‚™é™£åˆ—è½‰æ›ç‚ºåˆ†è™Ÿåˆ†éš”çš„å­—ä¸²
                    const equipmentStr = stat.è¨­å‚™.join(';');
                    
                    results.push({
                        æ—¥æœŸ: stat.å·¥ä½œæ—¥æœŸ,
                        å» åˆ¥: stat.å» åˆ¥,
                        è¨­å‚™: equipmentStr,
                        å“¡å·¥å§“å: stat.å“¡å·¥å§“å,
                        é–‹å§‹æ™‚é–“: startTimeStr,
                        çµæŸæ™‚é–“: endTimeStr,
                        å·¥ä½œæœŸé–“: durationStr, // æ”¹åç‚ºã€Œå·¥ä½œæœŸé–“ã€
                        å·¥æ™‚æ•¸å€¼: hoursDiff,
                        ç•°å¸¸ç‹€æ³: isAbnormal
                    });
                });

                allProcessedData = results;
                setupFilters(results);
                
            } catch (error) {
                filterArea.innerHTML = `<div class="error">âŒ è™•ç†æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}</div>`;
                console.error('è™•ç†éŒ¯èª¤:', error);
            }
        }

        function setupFilters(data) {
            const uniqueDates = [...new Set(data.map(item => item.æ—¥æœŸ))].sort();
            const uniqueFactories = [...new Set(data.map(item => item.å» åˆ¥))].sort();
            
            console.log('å”¯ä¸€æ—¥æœŸ:', uniqueDates);
            console.log('å”¯ä¸€å» åˆ¥:', uniqueFactories);
            
            const filterArea = document.getElementById('filterArea');
            filterArea.innerHTML = `
                <h3>ğŸ” ç¯©é¸æ¢ä»¶</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label for="dateSelect">é¸æ“‡æ—¥æœŸï¼š</label>
                        <select id="dateSelect">
                            <option value="">å…¨éƒ¨æ—¥æœŸ</option>
                            ${uniqueDates.map(date => `<option value="${date}">${date}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label for="factorySelect">é¸æ“‡å» åˆ¥ï¼š</label>
                        <select id="factorySelect">
                            <option value="">å…¨éƒ¨å» åˆ¥</option>
                            ${uniqueFactories.map(factory => `<option value="${factory}">${factory}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <button class="process-btn" onclick="applyFilters()" style="background: #f39c12;">
                    ğŸ“‹ å¥—ç”¨ç¯©é¸ä¸¦é¡¯ç¤ºçµæœ
                </button>
            `;
        }

        function applyFilters() {
            if (!allProcessedData) {
                alert('è«‹å…ˆè™•ç†æª”æ¡ˆ');
                return;
            }

            const selectedDate = document.getElementById('dateSelect').value;
            const selectedFactory = document.getElementById('factorySelect').value;
            
            let filteredData = allProcessedData;
            
            if (selectedDate) {
                filteredData = filteredData.filter(item => item.æ—¥æœŸ === selectedDate);
            }
            
            if (selectedFactory) {
                filteredData = filteredData.filter(item => item.å» åˆ¥ === selectedFactory);
            }
            
            // å¥—ç”¨æ’åºï¼šå…ˆä¾ç•°å¸¸ç‹€æ³ï¼Œå†ä¾å·¥æ™‚æ•¸å€¼
            filteredData = sortData(filteredData);
            
            processedData = filteredData;
            displayResults(filteredData);
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            const resultsContent = document.getElementById('resultsContent');
            
            if (data.length === 0) {
                resultsContent.innerHTML = '<div class="error">âŒ æ²’æœ‰ç¬¦åˆç¯©é¸æ¢ä»¶çš„è³‡æ–™</div>';
                resultsDiv.style.display = 'block';
                return;
            }

            const totalEmployees = new Set(data.map(item => item.å“¡å·¥å§“å)).size;
            const abnormalCount = data.filter(item => item.ç•°å¸¸ç‹€æ³).length;
            const normalCount = data.length - abnormalCount;
            
            const avgHours = data.reduce((sum, item) => sum + item.å·¥æ™‚æ•¸å€¼, 0) / data.length;

            let tableHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${data.length}</div>
                        <div class="stat-label">ç¸½è¨˜éŒ„æ•¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${totalEmployees}</div>
                        <div class="stat-label">å“¡å·¥äººæ•¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${normalCount}</div>
                        <div class="stat-label">æ­£å¸¸å·¥æ™‚</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${abnormalCount}</div>
                        <div class="stat-label">ç•°å¸¸å·¥æ™‚</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${avgHours.toFixed(1)}</div>
                        <div class="stat-label">å¹³å‡å·¥æ™‚</div>
                    </div>
                </div>
                
                <div class="sample-data">
                    <h4>ğŸ“‹ è©³ç´°è³‡æ–™ <small style="color: #7f8c8d;">(å·²æ’åºï¼šç•°å¸¸ç‹€æ³å„ªå…ˆï¼Œå·¥ä½œæœŸé–“ç”±å°‘è‡³å¤š)</small></h4>
                    <table>
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>å» åˆ¥</th>
                                <th>è¨­å‚™</th>
                                <th>å“¡å·¥å§“å</th>
                                <th>é–‹å§‹æ™‚é–“</th>
                                <th>çµæŸæ™‚é–“</th>
                                <th>å·¥ä½œæœŸé–“</th>
                                <th>ç‹€æ…‹</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            data.forEach(item => {
                const rowClass = item.ç•°å¸¸ç‹€æ³ ? 'abnormal-row' : '';
                const hoursClass = item.ç•°å¸¸ç‹€æ³ ? 'abnormal-hours' : 'normal-hours';
                const statusIcon = item.ç•°å¸¸ç‹€æ³ ? 'âš ï¸' : 'âœ…';
                
                tableHTML += `
                    <tr class="${rowClass}">
                        <td>${item.æ—¥æœŸ}</td>
                        <td>${item.å» åˆ¥}</td>
                        <td>${item.è¨­å‚™}</td>
                        <td>${item.å“¡å·¥å§“å}</td>
                        <td>${item.é–‹å§‹æ™‚é–“}</td>
                        <td>${item.çµæŸæ™‚é–“}</td>
                        <td class="hours-cell ${hoursClass}">${item.å·¥ä½œæœŸé–“}</td>
                        <td>${statusIcon}</td>
                    </tr>
                `;
            });

            tableHTML += `
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button class="download-btn" onclick="downloadCSV()">
                        ğŸ“¥ ä¸‹è¼‰ CSV æª”æ¡ˆ
                    </button>
                </div>
            `;

            resultsContent.innerHTML = tableHTML;
            resultsDiv.style.display = 'block';
        }

        function downloadCSV() {
            if (!processedData || processedData.length === 0) {
                alert('æ²’æœ‰è³‡æ–™å¯ä¸‹è¼‰');
                return;
            }

            const headers = ['æ—¥æœŸ', 'å» åˆ¥', 'è¨­å‚™', 'å“¡å·¥å§“å', 'é–‹å§‹æ™‚é–“', 'çµæŸæ™‚é–“', 'å·¥ä½œæœŸé–“', 'ç•°å¸¸ç‹€æ³'];
            const csvContent = [
                headers.join(','),
                ...processedData.map(row => [
                    row.æ—¥æœŸ,
                    row.å» åˆ¥,
                    row.è¨­å‚™,
                    row.å“¡å·¥å§“å,
                    row.é–‹å§‹æ™‚é–“,
                    row.çµæŸæ™‚é–“,
                    row.å·¥ä½œæœŸé–“,
                    row.ç•°å¸¸ç‹€æ³ ? 'ç•°å¸¸' : 'æ­£å¸¸'
                ].join(','))
            ].join('\n');

            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'æ¯æ—¥ä½œæ¥­å“¡å·¥æ™‚æ˜ç´°è¡¨.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
    </script>
</body>

</html>







